
<!DOCTYPE html>  <html lang="ar">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>إقرار وتنبيهات قانونية</title>  
    <link rel="stylesheet" href="styles.css">  
    <style>  
        #firebase-status {  
            position: fixed;  
            top: -50px;  
            left: 50%;  
            transform: translateX(-50%);  
            background-color: white;  
            padding: 8px 16px;  
            border-radius: 5px;  
            font-size: 14px;  
            font-weight: bold;  
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);  
            transition: top 0.5s ease-in-out, opacity 0.5s ease-in-out;  
            opacity: 0;  
            z-index: 1000;  
        }  
        .loading {  
            background-color: #ccc !important;  
            cursor: not-allowed;  
            position: relative;  
        }  
        .loading-spinner {  
            position: fixed;  
            top: 50%;  
            left: 50%;  
            transform: translate(-50%, -50%);  
            width: 50px;  
            height: 50px;  
            border: 5px solid #ccc;  
            border-top-color: #007bff;  
            border-radius: 50%;  
            animation: spin 1s linear infinite;  
            display: none;  
            z-index: 2000;  
        }  
        @keyframes spin {  
            0% { transform: translate(-50%, -50%) rotate(0deg); }  
            100% { transform: translate(-50%, -50%) rotate(360deg); }  
        }  
        .small-btn {  
            padding: 6px 12px;  
            font-size: 14px;  
            margin-top: 5px;  
        }  
        .container {  
            max-width: 400px;  
            margin: auto;  
            text-align: center;  
        }  
    </style>  
</head>  
<body>  <div id="firebase-status"></div>  
<div class="loading-spinner" id="loadingSpinner"></div>  <script type="module">  
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";  
  import { getAuth, createUserWithEmailAndPassword, sendEmailVerification, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";  
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";  
  
  const firebaseConfig = {  
    apiKey: "AIzaSyCcxorEgUgnocy0vlJolVEtUkz-oyyWbLg",  
    authDomain: "forms-v.firebaseapp.com",  
    projectId: "forms-v",  
    storageBucket: "forms-v.firebasestorage.app",  
    messagingSenderId: "55307283635",  
    appId: "1:55307283635:web:f88d8f3387c928830ad4c6"  
  };  
  
  function showMessage(message, color) {  
    const statusDiv = document.getElementById("firebase-status");  
    statusDiv.textContent = message;  
    statusDiv.style.color = color;  
    statusDiv.style.top = "10px";   
    statusDiv.style.opacity = "1";  
    setTimeout(() => {  
      statusDiv.style.top = "-50px";   
      statusDiv.style.opacity = "0";  
    }, 1600);  
  }  
  
  function showLoading(show) {  
    document.getElementById("loadingSpinner").style.display = show ? "block" : "none";  
  }  
  
  let auth, db;  
  try {  
    const app = initializeApp(firebaseConfig);  
    auth = getAuth(app);  
    db = getFirestore(app);  
    console.log("✅ تم الاتصال بـ Firebase!");  
    showMessage("✅ تم الاتصال بـ Firebase", "green");  
  } catch (error) {  
    console.error("❌ فشل الاتصال بـ Firebase:", error);  
    showMessage("❌ فشل الاتصال بـ Firebase", "red");  
  }  
  
  document.addEventListener("DOMContentLoaded", () => {  
    const signupForm = document.getElementById("signupForm");  
    const sendVerifyBtn = document.getElementById("sendVerifyEmail");  
    const checkVerifyBtn = document.getElementById("verifyEmailBtn");  
    const submitDataBtn = document.getElementById("submitDataBtn");  
  
    sendVerifyBtn.addEventListener("click", async () => {  
      sendVerifyBtn.classList.add("loading");  
      showLoading(true);  
      const email = document.getElementById("email").value;  
      const password = "DefaultPassword123";    
  
      try {  
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);  
        const user = userCredential.user;  
        await sendEmailVerification(user);  
        alert("📩 تم إرسال رابط التحقق إلى بريدك الإلكتروني.");  
      } catch (error) {  
        alert("❌ خطأ: " + error.message);  
      } finally {  
        sendVerifyBtn.classList.remove("loading");  
        showLoading(false);  
      }  
    });  
  
    checkVerifyBtn.addEventListener("click", async () => {  
      checkVerifyBtn.classList.add("loading");  
      showLoading(true);  
      const user = auth.currentUser;  
      if (user) {  
        await user.reload();  
        if (user.emailVerified) {  
          alert("✅ تم التحقق! يمكنك الآن إرسال البيانات.");  
          submitDataBtn.disabled = false;  
        } else {  
          alert("⚠️ لم يتم التحقق بعد.");  
        }  
      } else {  
        alert("❌ لا يوجد مستخدم مسجل حاليًا.");  
      }  
      checkVerifyBtn.classList.remove("loading");  
      showLoading(false);  
    });  
  
    submitDataBtn.addEventListener("click", async () => {  
      submitDataBtn.classList.add("loading");  
      showLoading(true);  
  
      try {  
        await addDoc(collection(db, "submissions"), {  
          name: document.getElementById("fullName").value,  
          email: document.getElementById("email").value,  
          phone: document.getElementById("phone").value,  
          gender: document.getElementById("gender").value,  
          nationality: document.getElementById("nationality").value  
        });  
  
        window.location.href = "success.html";   
      } catch (error) {  
        alert("❌ فشل في إرسال البيانات: " + error.message);  
      } finally {  
        submitDataBtn.classList.remove("loading");  
        showLoading(false);  
      }  
    });  
  });  
</script>  <div class="container">  
    <h2>إقرار وتنبيهات قانونية</h2>  <form id="signupForm">  
    <input type="text" id="fullName" placeholder="الاسم بالكامل" required>  
    <input type="email" id="email" placeholder="البريد الإلكتروني" required>  
    <button type="button" id="sendVerifyEmail" class="small-btn">إرسال رابط التحقق</button>  
      
    <input type="tel" id="phone" placeholder="رقم الهاتف" required>  

    <button type="button" id="verifyEmailBtn">تأكيد التحقق</button>  

    <select id="gender">  
        <option value="" disabled selected>اختر الجنس</option>  
        <option value="male">ذكر</option>  
        <option value="female">أنثى</option>  
    </select>  

    <input type="text" id="nationality" placeholder="الجنسية" required>  

    <div class="terms">  
        <label>  
            أوافق على <a href="terms.html" target="_blank">الإقرار وسياسة الاستخدام</a>  
            <input type="checkbox" id="terms" required>  
        </label>  
    </div>  

    <p class="whatsapp-link">📌 انضم إلى <a href="https://whatsapp.com/channel/0029Vb8xtjLIHphPBtwBWu3J" target="_blank">قناة الواتساب</a></p>  

    <button type="button" id="submitDataBtn" disabled>إرسال البيانات</button>  
</form>

</div>  </body>  
</html>
