<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฅูุฑุงุฑ ูุชูุจููุงุช ูุงููููุฉ</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            direction: rtl;
            text-align: center; /* ุฌุนู ุงููุต ูู ุงูููุชุตู */
            font-family: Arial, sans-serif;
            font-size: 12px; /* ุชุตุบูุฑ ุงูุฎุท */
        }
        .container {
            max-width: 400px;
            margin: auto;
        }
        input, select, button {
            width: 100%;
            padding: 8px;
            margin: 4px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            display: block;
            font-size: 12px; /* ุชุตุบูุฑ ุงูุฎุท */
        }
        .btn-group {
            display: flex;
            justify-content: center; /* ุฌุนู ุงูุฃุฒุฑุงุฑ ูู ุงูููุชุตู */
        }
        .btn-group button {
            flex: 1;
            margin: 4px;
            font-size: 12px; /* ุชุตุบูุฑ ุงูุฎุท */
        }
        .terms {
            text-align: center; /* ุฌุนู ุงููุต ูู ุงูููุชุตู */
            font-size: 12px; /* ุชุตุบูุฑ ุงูุฎุท */
        }
        .whatsapp-link {
            text-align: center; /* ุฌุนู ุงููุต ูู ุงูููุชุตู */
            font-size: 12px; /* ุชุตุบูุฑ ุงูุฎุท */
        }
        .small-btn {
            padding: 6px 12px;
            font-size: 12px; /* ุชุตุบูุฑ ุงูุฎุท */
            margin-top: 4px;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>ุฅูุฑุงุฑ ูุชูุจููุงุช ูุงููููุฉ</h2>

    <form id="signupForm">
        <input type="text" id="fullName" placeholder="ุงูุงุณู ุจุงููุงูู" required>
        <input type="email" id="email" placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู" required>

        <div class="btn-group">
            <button type="button" id="verifyEmailBtn">ุชุฃููุฏ ุงูุชุญูู</button>
            <button type="button" id="sendVerifyEmail" class="small-btn">ุฅุฑุณุงู ุฑุงุจุท ุงูุชุญูู</button>
        </div>

        <input type="tel" id="phone" placeholder="ุฑูู ุงููุงุชู" required>

        <select id="gender">
            <option value="" disabled selected>ุงุฎุชุฑ ุงูุฌูุณ</option>
            <option value="male">ุฐูุฑ</option>
            <option value="female">ุฃูุซู</option>
        </select>

        <input type="text" id="nationality" placeholder="ุงูุฌูุณูุฉ" required>

        <div class="terms">
            <label>
                ุฃูุงูู ุนูู <a href="terms.html" target="_blank">ุงูุฅูุฑุงุฑ ูุณูุงุณุฉ ุงูุงุณุชุฎุฏุงู</a>
                <input type="checkbox" id="terms" required>
            </label>
        </div>

        <p class="whatsapp-link">๐ ุงูุถู ุฅูู <a href="https://whatsapp.com/channel/0029Vb8xtjLIHphPBtwBWu3J" target="_blank">ููุงุฉ ุงููุงุชุณุงุจ</a></p>

        <button type="button" id="submitDataBtn" disabled>ุฅุฑุณุงู ุงูุจูุงูุงุช</button>
    </form>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, sendEmailVerification, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCcxorEgUgnocy0vlJolVEtUkz-oyyWbLg",
    authDomain: "forms-v.firebaseapp.com",
    projectId: "forms-v",
    storageBucket: "forms-v.firebasestorage.app",
    messagingSenderId: "55307283635",
    appId: "1:55307283635:web:f88d8f3387c928830ad4c6"
  };

  function showMessage(message, color) {
    alert(message);
  }

  let auth, db;
  try {
    const app = initializeApp(firebaseConfig);
    auth = getAuth(app);
    db = getFirestore(app);
  } catch (error) {
    console.error("โ ูุดู ุงูุงุชุตุงู ุจู Firebase:", error);
  }

  document.addEventListener("DOMContentLoaded", () => {
    const sendVerifyBtn = document.getElementById("sendVerifyEmail");
    const checkVerifyBtn = document.getElementById("verifyEmailBtn");
    const submitDataBtn = document.getElementById("submitDataBtn");

    sendVerifyBtn.addEventListener("click", async () => {
      const email = document.getElementById("email").value;
      const password = "DefaultPassword123";

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        await sendEmailVerification(user);
        alert("๐ฉ ุชู ุฅุฑุณุงู ุฑุงุจุท ุงูุชุญูู ุฅูู ุจุฑูุฏู ุงูุฅููุชุฑููู.");
      } catch (error) {
        alert("โ ุฎุทุฃ: " + error.message);
      }
    });

    checkVerifyBtn.addEventListener("click", async () => {
      const user = auth.currentUser;
      if (user) {
        await user.reload();
        if (user.emailVerified) {
          alert("โ ุชู ุงูุชุญูู! ููููู ุงูุขู ุฅุฑุณุงู ุงูุจูุงูุงุช.");
          submitDataBtn.disabled = false;
        } else {
          alert("โ๏ธ ูู ูุชู ุงูุชุญูู ุจุนุฏ.");
        }
      } else {
        alert("โ ูุง ููุฌุฏ ูุณุชุฎุฏู ูุณุฌู ุญุงูููุง.");
      }
    });

    submitDataBtn.addEventListener("click", async () => {
      try {
        await addDoc(collection(db, "submissions"), {
          name: document.getElementById("fullName").value,
          email: document.getElementById("email").value,
          phone: document.getElementById("phone").value,
          gender: document.getElementById("gender").value,
          nationality: document.getElementById("nationality").value
        });

        window.location.href = "success.html";
      } catch (error) {
        alert("โ ูุดู ูู ุฅุฑุณุงู ุงูุจูุงูุงุช: " + error.message);
      }
    });
  });
</script>

</body>
</html>
